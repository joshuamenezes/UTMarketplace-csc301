{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>UTMarketplace - Listings</title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
	<link href="{% static 'css/signup.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css">
</head>
<body class="bg-img">

	<div class="hero">

<!---------------------- Header Bar  ---------------------->


		<div class="container-fluid">
			<a href="{% url 'home' %}">
				<div class="">
					<img class="m-2" id="nav-img" src="{% static 'img/logo.png' %}">
				</div>
			</a>
		</div>


<!---------------------- Navigation Bar  ---------------------->

		<nav class="navbar-expand-sm navbar-dark bg-uoft">
			<div class="container-fluid">
				<button class="navbar-toggler" type="button">
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse">
					<ul class="navbar-nav me-auto">
						<li class="nav-item px-3 hov">
							<a class="nav-link text-white py-3" href="/listings">Home</a>
						</li>
						<li class="nav-item px-3 hov">
							<a class="nav-link text-white py-3" href="/listings/add-listing">Sell</a>
						</li>
					</ul>

					<div class="hov mx-2">
						<a class="p-3 py-5" href="/users/bookmarks">
							<i class="bi bi-bookmarks-fill h2 text-white"></i>
						</a>
					</div>


					<form class="d-flex" method="GET" action="{% url 'search_results' %}">
						<input class="form-control me-2" type="text" name="search">
						<button class="btn btn-primary" type="submit">Search</button>
					</form>

					<div class="hov mx-3">
						<a class="nav-link text-white py-3 mx-2" href="/users/logout">Logout</a>
					</div>
					<div class="hov">
						<a class="px-3 py-5" href="/users/profile/{{request.user.id}}">
							<i class="bi bi-person-circle h2 text-white"></i>
						</a>
					</div>
				</div>

			</div>
		</nav>


		<div class="container-fluid">
        
        <!---------------------- Side bar  ---------------------->
        
        
                    <div class="row">
                        <div class="col-3 col-lg-3 col-xl-2 m-3 menu bg-uoft text-white">
                            <h2 class="text-center mt-3">MENU</h2>
                            <details class="mt-4">
                                <summary><p class="d-inline">Textbooks</p></summary>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">Anthropology</a>
                                    <a href="#" class="list-group-item list-group-item-action">Biology</a>
                                    <a href="#" class="list-group-item list-group-item-action">Chemical $ physical science</a>
                                    <a href="#" class="list-group-item list-group-item-action">Economics</a>
                                    <a href="#" class="list-group-item list-group-item-action">English & Drama</a>
                                    <a href="#" class="list-group-item list-group-item-action">Geography</a>
                                    <a href="#" class="list-group-item list-group-item-action">Historical Studies</a>
                                    <a href="#" class="list-group-item list-group-item-action">ICCIT</a>
                                    <a href="#" class="list-group-item list-group-item-action">Languages Studies</a>
                                    <a href="#" class="list-group-item list-group-item-action">Management</a>
                                    <a href="#" class="list-group-item list-group-item-action">MCS</a>
                                    <a href="#" class="list-group-item list-group-item-action">Philosophy</a>
                                    <a href="#" class="list-group-item list-group-item-action">Political Science</a>
                                    <a href="#" class="list-group-item list-group-item-action">Psychology</a>
                                    <a href="#" class="list-group-item list-group-item-action">Sociology</a>
                                    <a href="#" class="list-group-item list-group-item-action">Visual Studies</a>
                                </div>
                            </details>					
        
                            <details class="mt-4">
                                <summary><p class="d-inline">Notes</p></summary>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">Note 1</a>
                                    <a href="#" class="list-group-item list-group-item-action">Note 2</a>
                                    <a href="#" class="list-group-item list-group-item-action">Note 3</a>
                                </div>
                            </details>					
        
                            <details class="mt-4">
                                <summary><p class="d-inline">Tutors</p></summary>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">Tutor 1</a>
                                    <a href="#" class="list-group-item list-group-item-action">Tutor 2</a>
                                    <a href="#" class="list-group-item list-group-item-action">Tutor 3</a>
                                </div>
                            </details>
        
                            <details class="mt-4">
                                <summary><p class="d-inline">Electronics</p></summary>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">Electronics 1</a>
                                    <a href="#" class="list-group-item list-group-item-action">Electronics 2</a>
                                    <a href="#" class="list-group-item list-group-item-action">Electronics 3</a>
                                </div>
                            </details>
        
                            <details class="mt-4">
                                <summary><p class="d-inline mb-3">Miscellaneous</p></summary>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action">Miscellaneous 1</a>
                                    <a href="#" class="list-group-item list-group-item-action">Miscellaneous 2</a>
                                    <a href="#" class="list-group-item list-group-item-action">Miscellaneous 3</a>
                                </div>
                            </details>
        
                        </div>








                        <div class="col-7 col-lg-8 col-xl-9 bg-white m-3">
                            <h1 class="text-center mt-3">Profile</h1>
                            <section style="background-color: #eee;">
                                <div class="container py-5">
                                  <div class="row">
                                  </div>
                              
                                  <div class="row">
                                    <div class="col-lg-4">
                                      <div class="card mb-4">
                                        <div class="card-body text-center">
                                          <img src="{% static user.avatar.url %}" alt="avatar" class="rounded-circle img-fluid" style="width: 150px;">
                                          <h5 class="my-3">Username: {{ user.username }}</h5>
                                            {% if is_user %}
                                          <div class="d-flex justify-content-center mb-2">
                                            <a href="{% url 'edit_profile' %}"><button type="button" class="btn btn-primary">Edit Profile</button></a>
                                          </div>
                                          
                                          <div class="d-flex justify-content-center mb-2">
                                            <!-- <div>{{ user.id}}</div> -->
                                            <form action="/users/delete_account/{{ request.user.id }}">
                                              <input id="delete-account-btn" type="submit" class="btn btn-primary" value="Delete Account" />
                                            </form>
                                          </div>
                                                {% else %}
                                                <div class="d-flex justify-content-center mb-2">
                                            <a href="{% url 'report' user_id=user.id %}"><button type="button" class="btn btn-primary">Report User</button></a>
                                          </div>
                                            <div class="rate">
                                                <div class="row">
                                                    <div class="col">
                                                        <span>Review</span>
                                                        <i class="rate_star bi bi-star-fill text-warning star_fill" style="cursor: pointer;"></i>
                                                        <i class="rate_star bi bi-star-fill text-warning star_fill" style="cursor: pointer;"></i>
                                                        <i class="rate_star bi bi-star-fill text-warning star_fill" style="cursor: pointer;"></i>
                                                        <i class="rate_star bi bi-star-fill text-warning star_fill" style="cursor: pointer;"></i>
                                                        <i class="rate_star bi bi-star-fill text-warning star_fill" style="cursor: pointer;"></i>
                                                    </div>
                                                </div>
                                                <textarea maxlength="300" class="textarea form-control" id="rate_note"></textarea>
                                                <button class="btn btn-primary btn-sm" id="rate_submit">Submit</button>
                                            </div>
                                            <script>
                                                delete_acc = document.getElementById("delete-account-btn");
                                                delete_acc.addEventListener("click", () => {
                                                    alert("Please check your email to confirm account deletion.");
                                                })
                                            </script>
                                            <script>
                                                    var ratingStars = [...document.getElementsByClassName("rate_star")];

                                                    function executeRating(stars) {
                                                      const starClassActive = "rate_star bi bi-star-fill text-warning star_fill";
                                                      const starClassInactive = "rate_star bi bi-star text-warning";
                                                      const starsLength = stars.length;
                                                      let i;
                                                      stars.map((star) => {
                                                        star.onclick = () => {

                                                          if (star.className===starClassInactive) {
                                                              i = stars.indexOf(star);
                                                              for (i; i >= 0; --i) stars[i].className = starClassActive;
                                                          } else {
                                                              i = stars.indexOf(star) + 1;
                                                              for (i; i < starsLength; ++i) stars[i].className = starClassInactive;
                                                          }

                                                        };
                                                      });
                                                    }
                                                    executeRating(ratingStars);

                                                    document.getElementById("rate_submit").onclick = function () {
                                                        var star_fill = [...document.getElementsByClassName("star_fill")];
                                                        const starsLength = star_fill.length;
                                                        let req = new XMLHttpRequest();
                                                        req.open("POST", "/users/rate/", true);
                                                        req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
                                                        req.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                                                        const formdata = "rate=" + starsLength + "&user=" + "{{ user.id }}" +
                                                            "&text=" + document.getElementsByClassName("rate_note").value;
                                                        req.send(formdata);
                                                    }
                                            </script>
                                            {% endif %}
                                        </div>
                                      </div>









                                      
                                      <div class="card mb-4 mb-lg-0">
                                        <div class="card-body p-0">
                                          </ul>
                                        </div>
                                      </div>
                                    </div>
                                    <div class="col-lg-8">
                                      <div class="card mb-4">
                                        <div class="card-body">
                                          <div class="row">
                                            <div class="col-sm-3">
                                              <p class="mb-0">Email</p>
                                            </div>
                                            <div class="col-sm-9">
                                              <p class="text-muted mb-0">{{ user.email }}</p>
                                            </div>
                                          </div>
                                          <hr>
                                          <div class="row">
                                            <div class="col-sm-3">
                                              <p class="mb-0">Rating</p>
                                            </div>
                                            <div class="col-sm-9">
                                                <head>
                                                    <!-- Font Awesome Icon Library -->
                                                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
                                                    <style>
                                                    .checked {
                                                      color: orange;
                                                    }
                                                    </style>
                                                    </head>
                                                    <body>

                                                    {% for i in star_range %}
                                                        <i class="bi bi-star-fill text-warning"></i>
                                                    {% endfor %}
                                                    {% if half_star %}
                                                        <i class="bi bi-star-half text-warning"></i>
                                                    {% endif %}
                                                    {% for i in star_empty %}
                                                        <i class="bi bi-star text-warning"></i>
                                                    {% endfor %}
                                            </div>
                                          </div>
                                        </div>
                                      </div>

                                      <hr>
                                      <h1>Posts</h1>

                                      
                                      {% for listing in listing_set %}
                                      <div class="card" style="width: 18rem;">
                                        <div class="portrait" data-mdb-ripple-color="light">
                                          <img src="{% static listing.image.url %}" class="img-fluid" />
                                          <a href="#!">
                                            <div class="mask" style="background-color: rgba(251, 251, 251, 0.15)"></div>
                                          </a>
                                        </div>

                                        <div class="card-body">
                                          <h5 class="card-title">{{ listing.listing_title }}</h5>
                                          <p class="card-text">
                                            {{ listing.item_name }}
                                          </p>
                                      
                                          <button type="button" class="btn btn-primary">View Listing</button>
                                        </div>
                                      </div>
                                        {% endfor %}
                                      
                                            




























                                      
                              </section>










                                      
                            
                    








                </div>
                        <script>
                            delete_acc = document.getElementById("delete-account-btn");
                            delete_acc.addEventListener("click", () => {
                                alert("Please check your email to confirm account deletion.");
                            })
                        </script>








</body>
</html>









