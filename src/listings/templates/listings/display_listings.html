{% load static %}

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>UTMarketplace - Listings</title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
	<link href="{% static 'css/signup.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css">
</head>
<body class="bg-img">

	<div class="hero">

<!---------------------- Header Bar  ---------------------->


		<div class="container-fluid">
			<a href="{% url 'home' %}">
				<div class="">
					<img class="m-2" id="nav-img" src="{% static 'img/logo.png' %}">
				</div>
			</a>
		</div>


<!---------------------- Navigation Bar  ---------------------->

		<nav class="navbar-expand-sm navbar-dark bg-uoft">
			<div class="container-fluid">
				<button class="navbar-toggler" type="button">
					<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse">
					<ul class="navbar-nav me-auto">
						<li class="nav-item px-3 hov">
							<a class="nav-link text-white py-3" href="/listings">Home</a>
						</li>
						<li class="nav-item px-3 hov">
							<a class="nav-link text-white py-3" href="/listings/add-listing">Sell</a>
						</li>
					</ul>

					<div class="hov mx-2">
						<a class="p-3 py-5" href="/users/bookmarks">
							<i class="bi bi-bookmarks-fill h2 text-white"></i>
						</a>
					</div>


					<form class="d-flex" method="GET" action="{% url 'search_results' %}">
						<input class="form-control me-2" type="text" name="search">
						<button class="btn btn-primary" type="submit">Search</button>
					</form>

					<div class="hov mx-3">
						<a class="nav-link text-white py-3 mx-2" href="/users/logout">Logout</a>
					</div>
					<div class="hov">
						<a class="px-3 py-5" href="/users/profile/{{request.user.id}}">
							<i class="bi bi-person-circle h2 text-white"></i>
						</a>
					</div>
				</div>

			</div>
		</nav>


		<div class="container-fluid">




		<!---------------------- Side bar  ---------------------->

		<div class="container-fluid">

			<div class="row">
				<div class="col-3 col-lg-3 col-xl-2 m-3 menu bg-uoft text-white">
					<h2 class="text-center mt-3">MENU</h2>
					<details class="mt-4">
						<summary>
							<p class="d-inline">Textbooks</p>
						</summary>
						<div class="list-group">
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="anthropology">Anthropology</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="biology">Biology</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="chemical_physical_sciences">Chemical & Physical Sciences</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="economics">Economics</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="english_drama">English & Drama</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="geography">Geography</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="history">Historical Studies</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="iccit">ICCIT</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="language_studies">Languages Studies</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="management">Management</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="mcs">MCS</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="philosopy">Philosophy</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="political_science">Political Science</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="psychology">Psychology</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="sociology">Sociology</button>
							<button form="filter" name="category" class="list-group-item list-group-item-action" type="submit" value="visual_studies">Visual Studies</button>
						</div>
					</details>

					<details class="mt-4">
						<summary>
							<p class="d-inline">Notes</p>
						</summary>
						<div class="list-group">
							<a href="#" class="list-group-item list-group-item-action">Note 1</a>
							<a href="#" class="list-group-item list-group-item-action">Note 2</a>
							<a href="#" class="list-group-item list-group-item-action">Note 3</a>
						</div>
					</details>

					<details class="mt-4">
						<summary>
							<p class="d-inline">Tutors</p>
						</summary>
						<div class="list-group">
							<a href="#" class="list-group-item list-group-item-action">Tutor 1</a>
							<a href="#" class="list-group-item list-group-item-action">Tutor 2</a>
							<a href="#" class="list-group-item list-group-item-action">Tutor 3</a>
						</div>
					</details>

					<details class="mt-4">
						<summary>
							<p class="d-inline">Electronics</p>
						</summary>
						<div class="list-group">
							<a href="#" class="list-group-item list-group-item-action">Electronics 1</a>
							<a href="#" class="list-group-item list-group-item-action">Electronics 2</a>
							<a href="#" class="list-group-item list-group-item-action">Electronics 3</a>
						</div>
					</details>

					<details class="mt-4">
						<summary>
							<p class="d-inline mb-3">Miscellaneous</p>
						</summary>
						<div class="list-group">
							<a href="#" class="list-group-item list-group-item-action">Miscellaneous 1</a>
							<a href="#" class="list-group-item list-group-item-action">Miscellaneous 2</a>
							<a href="#" class="list-group-item list-group-item-action">Miscellaneous 3</a>
						</div>
					</details>

				</div>

				<!---------------------- Listings  ---------------------->

				<div class="col-7 col-lg-8 col-xl-9 bg-white m-3">
					{% if request.GET.category %}
						<h1 class="text-center mt-3">{{ request.GET.category | title }}</h1>
					{% else %}
						<h1 class="text-center mt-3">Listings</h1>
					{% endif %}
					
					<form action="{% url 'listing-home' %}" method="GET" id="filter">
						<label for="">Starting price</label>
						<input type="number" name="start-price" id="start-price">
						<label for="">Ending price</label>
						<input type="number" name="end-price" id="end-price">	
						{% if request.GET.category %}
						<input type="hidden" name="hidden_category" value="{{ request.GET.category }}">
						{% endif %}
						<button type="submit"> Submit </button>
					</form>



					<div class="row mt-3">

						{% for listing in listings %}
						<div class="col-4">
							<div class="card ">
								<div class="row mx-5 mt-2">
									<div class="col-9"></div>
									<div class="col-2">
										<div class="hov mx-2">
											<button id="bookmark{{ listing.id }}btn">
												<a class="p-3 py-5">
													<i class="bi bi-bookmarks-fill h2 text-black"></i>
												</a>
											</button>
											<form method="POST" id="bookmark{{ listing.id }}"
												action="{% url 'bookmark' pk=listing.id %}"> {% csrf_token %}
												<input id="url_type" name="url_type" type="hidden" value="all_listings">
												<!-- Send in the URL to be redirected to-->
											</form>
											<!-- Submit the form if this user wants to bookmark the item-->
											
											<script>
												// Set an event listener for the bookmark button to bookmark the item
												bookmark_item_button = document.getElementById("bookmark{{ listing.id }}btn");
												bookmark_item_button.addEventListener("click", () => {
													alert("Bookmark updated!");
													document.getElementById("bookmark{{ listing.id }}").submit();
												})
											</script>

										</div>
									</div>
								</div>
								<div style="transform: rotate(0);">

									{% if not listing.image %}
									<img class="rounded" src="../../static/listing_images/default_listing.jpeg">
									{% else %}
									<div></div>
									<img class="rounded" src="../../static/listing_images/{{ listing.image }}" style="max-height: 30em; max-width: 35em">
									{% endif %}
									<div class="card-body">
										<!-- item title -->
										<a class="text-decoration-none text-black" href="">
											<h4>{{ listing.item_name }}</h4>
										</a>
										<!-- price -->
										<p>${{ listing.price|floatformat:2 }}</p>
										<!-- descriptions -->
										<a href="#" class="btn btn-primary">See details</a>
									</div>
									<a class="stretched-link" href="{% url 'single-listing' pk=listing.id %}"></a>

								</div>
							</div>
						</div>
						{% endfor %}



						<div class="row mt-5">
							<ul class="pagination justify-content-center">
								{% if page_obj.has_previous %}
									<li class="page-item"><a class="page-link" href="?page=1">&laquo</a></li>
									<li class="page-item"><a class="page-link" href="?page={{page_obj.previous_page_number}}">Previous</a></li>
								{% endif %}

								<li class="page-item active"><a class="page-link" href="">{{page_obj.number}}</a></li>

								{% if page_obj.has_next %}
									<li class="page-item"><a class="page-link" href="?page={{page_obj.next_page_number}}">Next</a></li>
									<li class="page-item"><a class="page-link" href="?page={{page_obj.paginator.num_pages}}">&raquo</a></li>
								{% endif %}

								
							</ul>
						</div>

					</div>




				</div>
			</div>

		</div>


		<!-- 	<div class="container-fluid">

			
			
	 	</div>


		<div class="display"><h1>BODY</h1></div> -->

	</div>
	<footer class="container-fluid bg-uoft">
		<p class="pt-3 pb-3 text-white text-center mb-0">copyright: All rights reserved</p>
	</footer>

</body>

</html>